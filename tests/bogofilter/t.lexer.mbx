#! /bin/sh

set -e

# Note:  When run via "make check", test output files are automatically deleted.
#	 When run from the command line, outputs files are left in directory
#	 robx.YYYYMMDD.  This is useful when something is different.
#
#	 ./inputs  - test inputs
#	 ./outputs - known correct outputs
#
#	 robx.YYYYMMDD:
#		tests   - directory containing individual output files

: ${srcdir=.}
relpath="`pwd`/../.."
NODB=1 . ${srcdir}/../t.frame

OUT="lexer.mbx.out"

verbose=0
if [ "$1" = "-v" ]; then
    verbose=1
fi

BOGOLEXER="$VAL ${relpath}/bogolexer"
for f in good spam ; do
    $BOGOLEXER -p < ${srcdir}/inputs/$f.mbx > $TMPDIR/$f.1
    sort -u < $TMPDIR/$f.1 > $TMPDIR/$f.2
done
RESULT=`cat $TMPDIR/spam.2 | wc -l`.`cat $TMPDIR/good.2 | wc -l`
RESULT=`echo $RESULT | sed s@\ @@g`

WANT="1146.3074"

if  [ $verbose -ne 0 ]; then
    echo want: $WANT, have: $RESULT > $TMPDIR/$OUT
fi

[ ! -z $BF_SAVEDIR ] && . ${srcdir}/../t.save

test "$RESULT" = "$WANT"
