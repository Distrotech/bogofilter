#! /bin/sh

set -e

# Note:  When run via "make check", test output files are automatically deleted.
#	 When run from the command line, outputs files are left in directory
#	 separate.YYYYMMDD.  This is useful when something is different.
#
#	Test options:
#	    "-W" - combined wordlist - spam and ham in wordlist.db
#	    "-WW" - separate wordlists - spamlist.db and wordlist.db

NODB=1 . ${srcdir=.}/t.frame

EXP="21 48"

# combined wordlists

$BOGOFILTER -W -s < ${SYSTEST}/inputs/spam.mbx
$BOGOFILTER -W -n < ${SYSTEST}/inputs/good.mbx

COM=`$BOGOUTIL   -W -w $BOGOFILTER_DIR .MSG_COUNT | tail -1 | awk '{printf "%s %s", $2, $3}'`

# separate wordlists

$BOGOFILTER -WW -s < ${SYSTEST}/inputs/spam.mbx
$BOGOFILTER -WW -n < ${SYSTEST}/inputs/good.mbx

SEP=`$BOGOUTIL   -W -w $BOGOFILTER_DIR .MSG_COUNT | tail -1 | awk '{printf "%s %s", $2, $3}'`

if [ "$COM" != "$EXP" ] ; then
    echo com: $COM, exp: $EXP
fi

if [ "$SEP" != "$EXP" ] ; then
    echo sep: $SEP, exp: $EXP
fi

if [ "$verbose" -gt 0 ] ; then
    echo com: $COM, sep: $SEP, exp: $EXP
fi

if [ "$SEP$COM" != "$EXP$EXP" ] ; then
    exit 1
fi
