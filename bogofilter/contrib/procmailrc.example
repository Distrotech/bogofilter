# $Id$
#
# procmailrc.example
#
#	This is a sample procmail setup file that 
#	1 - retains an unprocessed copy of all incoming mail
#	2 - diverts incoming mail with asian character sets
#	3 - runs bogofilter
#	4 - retains a processed copy of all messages identified as spam.
#	5 - retains a processed copy of all messages identified as unsure.
#

### bogofilter - filter & update word lists

MAILDIR=/var/spool/mail
BOGOFILTER_DIR=/var/lib/bogofilter

#### testing ####
## MAILDIR=/tmp/mail
## MAILDIR=/home/user/filter/korean.spam/mail
## procmail procmailrc < input.file ; echo $? ; ll -t $MAILDIR | head
#### end testing ####


#### backup ####
:0c:
mail.backup
####


## Silently drop all completely unreadable mail
:0:
* 1^0 ^\/Subject:.*=\?(.*big5|iso-2022-jp|ISO-2022-KR|euc-kr|gb2312|ks_c_5601-1987|windows-1251|windows-1256)\?
* 1^0 ^\/Content-Type:.*charset="(.*big5|iso-2022-jp|ISO-2022-KR|euc-kr|gb2312|ks_c_5601-1987|windows-1251|windows-1256)
spam-unreadable
####


#### bogofilter passthrough-update ####

:0fw
| bogofilter -f -p -u -l -e -v

#### begin error catcher ####

# m-a 10/28/02
#     if bogofilter failed, return the mail to the queue, the MTA will
#     retry to deliver it later
#     75 is the value for EX_TEMPFAIL in /usr/include/sysexits.h

:0e
{
	EXITCODE=75
	HOST
}

#### end error catcher ####


:0c:
* ^X-Bogosity: Spam
spam-bogofilter

:0c:
* ^X-Bogosity: Yes
spam-bogofilter

:0c:
* ^X-Bogosity: Unsure
unsure-bogofilter

#### end bogofilter passthrough-update ####


#### SpamAssassin ####
# :0c:
# * ^X-Spam-Status: Yes
# spam-spamassassin

#### end SpamAssassin ####


# #### bogofilter query-update-passthrough ####
#
#      Alternate approach using return codes from bogofilter.
# 
# :0HB
# * ? bogofilter -e v
# {
# 	:0c
# 	| bogofilter -s
# 
# 	:0fw
# 	| bogofilter -p
# 	/var/spool/mail/admin
# }
# 
# #else (E)
# 
# :0Ec
# | bogofilter -n
# 
# #always
# :0fw
# | bogofilter -p 
# 
# #### end bogofilter query-update-passthrough ####
